<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
</head>
<body>
<div id="test"></div>
<script>
    var require = {
        baseUrl: "./",
        paths: {
            "text": "./lib/require-text",
            "jquery": "../lib/jquery",
            "q": "../lib/runtime/q",
            "setimmediate": "../lib/setImmediate",
            "path": "../lib/runtime/path"
        },
        waitSeconds: 15
    };
</script>
<script src="http://localhost:9529/socket.io/socket.io.js"></script>
<script type="text/javascript" src="lib/require.js"></script>
<script type="text/javascript">
    var rootname = 'project';
    var renderthe = function (mod, data) {
        mod.render(data).then(function (ad) {
            $('#test').html(ad.html);
            ad.done();
        });
    };
    var loadmod = function (conf) {
        var hash = window.location.hash.replace('#', '');
        var runset = hash.split('.');
        var moduledir = rootname + '/' + runset[0];
        require([moduledir + '/index'], function (mod) {
            if (runset[1] === undefined) {
                renderthe(mod, {});
            } else {
                require(['text!' + moduledir + '/' + runset[1] + '.json'], function (data) {
                    renderthe(mod, data);
                });
            }
        });
    };

    var socket = io('http://localhost:9529');
    socket.on('updateTemplate', function (data) {
        if (/\.css$|\.jpg$|\.png$|\.jpeg$/.test(data.fn)) {
//            $('link[href=' + data.fn + ']').attr('src', data.fn);
        } else if (/\.html$|\.vm$|\.hogan$|\.jade$/.test(data.fn)) {

        }
    });

    require(['lib/runtime/subModule/index'], function () {
        loadmod();
        window.onhashchange = function () {
            loadmod();
        };
    });
</script>
</body>
</html>
